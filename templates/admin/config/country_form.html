{% extends "admin/base_admin.html" %}

{% block page_title %}{{ title }}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="mb-6">
        <div class="flex items-center justify-between">
            <h2 class="text-2xl font-bold">{{ title }}</h2>
            <a href="{{ url_for('admin.config_countries') }}" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                <i class="fas fa-arrow-left mr-2"></i>Back to Countries
            </a>
        </div>
    </div>

    <form method="POST" class="bg-white rounded-lg shadow p-6">
        {{ form.hidden_tag() }}

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">
                    Country Code <span class="text-red-500">*</span>
                </label>
                {{ form.code(class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500", maxlength="3", style="text-transform: uppercase") }}
                <p class="text-sm text-gray-600 mt-1">{{ form.code.description }}</p>
                {% if form.code.errors %}
                    <div class="text-red-500 text-sm mt-1">
                        {% for error in form.code.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">
                    Country Name <span class="text-red-500">*</span>
                </label>
                {{ form.name(class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500") }}
                <p class="text-sm text-gray-600 mt-1">{{ form.name.description }}</p>
                {% if form.name.errors %}
                    <div class="text-red-500 text-sm mt-1">
                        {% for error in form.name.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">
                    Continent <span class="text-red-500">*</span>
                </label>
                {{ form.continent(class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-red-500") }}
                <p class="text-sm text-gray-600 mt-1">{{ form.continent.description }}</p>
                {% if form.continent.errors %}
                    <div class="text-red-500 text-sm mt-1">
                        {% for error in form.continent.errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            <div>
                <label class="block text-gray-700 text-sm font-bold mb-2">
                    Flag Status
                </label>
                <div class="flex items-center">
                    {{ form.flag_available(class="h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded") }}
                    <label for="{{ form.flag_available.id }}" class="ml-2 text-sm text-gray-900">
                        {{ form.flag_available.label.text }}
                    </label>
                </div>
                <p class="text-sm text-gray-600 mt-1">{{ form.flag_available.description }}</p>
            </div>
        </div>

        <!-- Flag Preview -->
        <div class="mt-6" id="flagPreview" style="display: none;">
            <label class="block text-gray-700 text-sm font-bold mb-2">Flag Preview</label>
            <div class="border rounded-lg p-4 bg-gray-50">
                <img id="flagImage" src="" alt="" class="w-16 h-10 border border-gray-300 rounded">
                <p class="text-xs text-gray-600 mt-2">Expected path: /static/images/flags/<span id="flagPath"></span>.svg</p>
            </div>
        </div>

        <div class="mt-8 flex justify-end space-x-4">
            <a href="{{ url_for('admin.config_countries') }}" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600">
                Cancel
            </a>
            <button type="submit" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600">
                <i class="fas fa-save mr-2"></i>{{ 'Update' if country else 'Create' }} Country
            </button>
        </div>
    </form>
</div>

<div class="max-w-2xl mx-auto mt-6">
    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
        <h4 class="font-bold text-yellow-900 mb-2">
            <i class="fas fa-lightbulb mr-2"></i>Flag Setup Instructions
        </h4>
        <div class="text-sm text-yellow-800 space-y-2">
            <p><strong>1. Flag File:</strong> Upload the flag as an SVG file to <code>/static/images/flags/</code></p>
            <p><strong>2. Naming:</strong> Name the file with the country code (e.g., <code>TUN.svg</code>, <code>FRA.svg</code>)</p>
            <p><strong>3. Format:</strong> Use SVG format for scalability (recommended size: 64x40 pixels)</p>
            <p><strong>4. Enable:</strong> Check "Flag Available" only after uploading the actual file</p>
            <p><strong>5. Test:</strong> Verify the flag displays correctly in the athletes and results pages</p>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const codeInput = document.getElementById('code');
    const flagAvailable = document.getElementById('flag_available');
    const flagPreview = document.getElementById('flagPreview');
    const flagImage = document.getElementById('flagImage');
    const flagPath = document.getElementById('flagPath');

    function updateFlagPreview() {
        const code = codeInput.value.toUpperCase();
        if (code.length === 3) {
            flagPath.textContent = code;
            flagImage.src = `/static/images/flags/${code}.svg`;
            flagImage.alt = code;
            flagPreview.style.display = 'block';

            // Test if flag exists
            flagImage.onload = function() {
                flagImage.style.border = '2px solid green';
            };
            flagImage.onerror = function() {
                flagImage.style.border = '2px solid red';
                flagImage.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjQiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA2NCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjY0IiBoZWlnaHQ9IjQwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0yOCAyMEwzNiAyOE0zNiAyMEwyOCAyOCIgc3Ryb2tlPSIjNkI3MjgwIiBzdHJva2Utd2lkdGg9IjIiLz4KPC9zdmc+';
            };
        } else {
            flagPreview.style.display = 'none';
        }
    }

    codeInput.addEventListener('input', function() {
        this.value = this.value.toUpperCase();
        updateFlagPreview();
    });

    // Auto-uppercase country code
    codeInput.addEventListener('blur', function() {
        this.value = this.value.toUpperCase();
    });

    // Initial preview if editing
    if (codeInput.value) {
        updateFlagPreview();
    }
});
</script>

{% endblock %}